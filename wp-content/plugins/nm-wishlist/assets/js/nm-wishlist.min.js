/* NM Wishlist */
'use strict';(function(c){var f={init:function(){var a=this;if("undefined"!=typeof nm_wp_vars){a.$body=c("body");a.isLoggedIn=a.$body.hasClass("logged-in")?!0:!1;a.isSetUp=!1;a.wishlistIds=[];a.cookieExpires=parseInt(nm_wishlist_vars.wlCookieExpires);a.IDsUpdateAjax=!1;"0"!=nm_wishlist_vars.wlMenuCount?(a.headerLinkCount=!0,a.$headerLinkLi=c(".nm-menu-wishlist"),a.$headerLinkCount=a.$headerLinkLi.find(".nm-menu-wishlist-count")):a.headerLinkCount=!1;a.setUp();c(document).on("click",".nm-wishlist-button",
function(b){b.preventDefault();a.isSetUp?"0"==nm_wishlist_vars.wlLoginRequire||a.$body.hasClass("logged-in")?(a.IDsUpdateAjax&&(a.IDsUpdateAjax.abort(),a.IDsUpdateAjax=!1),a.buttonToggle(this)):(b=c("#nm-menu-account-btn"),b.length&&c("#nm-login-popup-wrap").length?b.trigger("click"):window.location.replace(nm_wishlist_vars.wlLoginRedirectUrl)):console.log("NM Wishlist: Not set-up yet, just a moment")});var d=c("#nm-wishlist-table");if(d.length)d.find(".nm-wishlist-remove").on("click",function(b){b.preventDefault();
a.isSetUp?(b=c(this),b.hasClass("clicked")||(b.addClass("clicked"),a.wishlistItemRemove(b,d))):console.log("NM Wishlist: Not set-up yet, just a moment")})}},setUp:function(){var a=this;if(a.isLoggedIn)c.ajax({type:"POST",url:nm_wp_vars.ajaxUrl,data:{action:"nm_wishlist_get_ids"},dataType:"json",cache:!1,headers:{"cache-control":"no-cache"},success:function(b){b.ids&&(b=b.ids,a.wishlistIds=b,Cookies.set("nm-wishlist-ids",JSON.stringify(b),{expires:a.cookieExpires}),a.headerLinkUpdate(),a.buttonsSetState())},
complete:function(){a.isSetUp=!0;a.$body.addClass("nm-wishlist-ready")}});else{if(void 0!==Cookies.getJSON)var d=Cookies.getJSON("nm-wishlist-ids");else{d=Cookies.get("nm-wishlist-ids");try{d=JSON.parse(d)}catch(b){}}d?(a.wishlistIds=d,a.headerLinkUpdate(),a.buttonsSetState()):Cookies.set("nm-wishlist-ids","[]",{expires:a.cookieExpires});a.isSetUp=!0;a.$body.addClass("nm-wishlist-ready")}},IDsUpdate:function(){var a=this,d=JSON.stringify(a.wishlistIds);Cookies.set("nm-wishlist-ids",d,{expires:a.cookieExpires});
a.isLoggedIn&&(a.IDsUpdateAjax=c.ajax({type:"POST",url:nm_wp_vars.ajaxUrl,data:{action:"nm_wishlist_update_ids",nonce:nm_wishlist_vars.wlNonce,ids:d},dataType:"json",cache:!1,headers:{"cache-control":"no-cache"},complete:function(){a.IDsUpdateAjax=!1}}))},buttonsSetState:function(){for(var a=0;a<this.wishlistIds.length;a++)c("#nm-wishlist-item-"+this.wishlistIds[a]+"-button").addClass("added");this.$body.addClass("wishlist-show-buttons")},buttonSetState:function(a,d){a=c(".nm-wishlist-item-"+a+"-button");
d?(a.addClass("added"),a.attr("title",nm_wishlist_vars.wlButtonTitleRemove),this.$body.trigger("wishlist_added_item")):(a.removeClass("added"),a.attr("title",nm_wishlist_vars.wlButtonTitleAdd),this.$body.trigger("wishlist_removed_item"))},buttonToggle:function(a){a=c(a).data("product-id");var d=!0,b=c.inArray(a,this.wishlistIds);-1==b?this.wishlistIds.unshift(a):(this.wishlistIds.splice(b,1),d=!1);this.IDsUpdate();this.headerLinkUpdate();this.buttonSetState(a,d)},wishlistItemRemove:function(a,d){c("#nm-wishlist-overlay").addClass("show");
var b=this,e=a.closest("ul");a=e.data("product-id");e.addClass("removing");a=c.inArray(a,b.wishlistIds);-1!=a&&b.wishlistIds.splice(a,1);b.IDsUpdate();b.headerLinkUpdate();setTimeout(function(){e.remove();b.$body.trigger("wishlist_removed_item");0==d.children("ul").length&&(c("#nm-wishlist").css("display","none"),c("#nm-wishlist-empty").addClass("show"));c("#nm-wishlist-overlay").removeClass("show")},500)},headerLinkUpdate:function(){this.headerLinkCount&&(this.wishlistIds.length?(this.$headerLinkLi.addClass("has-items"),
this.$headerLinkCount.text(this.wishlistIds.length)):(this.$headerLinkLi.removeClass("has-items"),this.$headerLinkCount.text("0")))}};c(function(){f.init()})})(jQuery);