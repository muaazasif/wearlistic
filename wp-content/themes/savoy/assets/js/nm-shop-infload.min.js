/* NM: Shop infinite load script */
(function(f){f.extend(f.nmTheme,{infload_init:function(){var a=this.$shopBrowseWrap.children(".nm-pagination");a.length&&a.hasClass("nm-infload")&&this.shopInfLoadBind()},shopInfLoadBind:function(){var a=this,d=a.$shopBrowseWrap.children(".nm-infload-controls");a.shopInfLoadBound=!0;a.infloadScroll=d.hasClass("scroll-mode")?!0:!1;if(a.infloadScroll){a.infscrollLock=!1;var g,c=Math.round(a.$document.height()-d.offset().top),h=parseInt(nm_wp_vars.infloadBuffer),e=null;a.$window.off("resize.nmInfLoad").on("resize.nmInfLoad",
function(){e&&clearTimeout(e);e=setTimeout(function(){var b=a.$shopBrowseWrap.children(".nm-infload-controls");b.length&&(c=Math.round(a.$document.height()-b.offset().top))},100)});a.$window.off("smartscroll.infscroll").on("smartscroll.infscroll",function(){a.infscrollLock||(g=0+a.$document.height()-a.$window.scrollTop()-a.$window.height(),g-h<c&&a.shopInfLoadGetPage())})}else d=f("#nm-shop-products"),d.on("click",".nm-infload-btn",function(b){b.preventDefault();a.shopInfLoadGetPage()}),d.on("click",
".nm-infload-to-top",function(b){b.preventDefault();a.shopScrollToTop()});a.infloadScroll&&a.$window.trigger("scroll")},shopInfLoadGetPage:function(){var a=this;if(a.shopAjax)return!1;a.shopRemoveNotices();var d=a.$shopBrowseWrap.children(".nm-infload-link").find("a"),g=a.$shopBrowseWrap.children(".nm-infload-controls"),c=d.attr("href"),h;c?(c=a.updateUrlParameter(c,"shop_load","products"),g.addClass("nm-loader"),a.$document.trigger("nm_infload_before",c),a.shopAjax=f.ajax({url:c,dataType:"html",
cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(e,b,k){console.log("NM: AJAX error - shopInfLoadGetPage() - "+k)},complete:function(){g.removeClass("nm-loader")},success:function(e){e=f("<div>"+e+"</div>");var b=e.children(".nm-products").children("li");b.addClass("hide");h=a.$document.scrollTop();a.$shopBrowseWrap.find(".nm-products:first").append(b);"0"!=nm_wp_vars.infloadPreserveScrollPos&&a.isChromium&&a.$html.scrollTop(h);setTimeout(function(){b.removeClass("hide")},
300);a.$shopBrowseWrap.hasClass("products-loaded")||a.$shopBrowseWrap.addClass("products-loaded");(c=e.find(".nm-infload-link").children("a").attr("href"))?d.attr("href",c):(a.$shopBrowseWrap.addClass("all-products-loaded"),a.infloadScroll?a.infscrollLock=!0:g.addClass("hide-btn"),d.removeAttr("href"));a.shopAjax=!1;a.infloadScroll&&a.$window.trigger("scroll");a.$document.trigger("nm_infload_after",b)}})):a.infloadScroll&&(a.infscrollLock=!0)}});f.nmThemeExtensions.infload=f.nmTheme.infload_init})(jQuery);