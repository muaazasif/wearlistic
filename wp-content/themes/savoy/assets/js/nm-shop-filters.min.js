/* NM: Shop filters script */
(function(c){c.extend(c.nmTheme,{filters_init:function(){this.$shopFilterMenu=c("#nm-shop-filter-menu");this.$shopSidebarPopupBtn=c("#nm-shop-sidebar-popup-button");this.shopSidebarLayout=c("#nm-shop-sidebar").data("sidebar-layout");this.filterPanelSliding=!1;this.filterPanelSlideSpeed=200;this.filterPanelHideWidth=551;this.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",sidebar:"shopDefaultSidebarToggle",search:"shopFiltersSearchToggle"};this.shopFiltersBind()},
shopFiltersBind:function(){var a=this;if(a.filtersEnableAjax)a.$header.on("click.nmHeaderShopAjax",".shop-ajax-link > a",function(b){b.preventDefault();var h=c(this),g=h.parents(".menu-item").last();g.addClass("no-hover");a.shopFiltersSearchClose();c("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat");b=a.shopScrollToTop();setTimeout(function(){a.shopGetPage(h.attr("href"));setTimeout(function(){g.removeClass("no-hover")},100)},b)});a.$shopFilterMenu.find("a").on("click",function(b){b.preventDefault();
if(!a.filterPanelSliding){a.shopRemoveNotices();a.filterPanelSliding=!0;b=0;var h=c(this).parent("li"),g=h.data("panel");h.hasClass("active")||(b=a.shopFiltersHideActivePanel());h.toggleClass("active");setTimeout(function(){a[a.shopFilterMenuFnNames[g]]()},b)}});if(a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_categories"))a.$shopWrap.on("click","#nm-shop-categories-wrap a",function(b){b.preventDefault();b=c(this);var h=b.parent("li");a.shopFiltersSearchClose();c("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat");
h.addClass("current-cat");a.shopGetPage(b.attr("href"))});if(a.$shopSidebarPopupBtn.length){a.$shopSidebarPopup=c("#nm-shop-sidebar-popup");var d=null;a.$window.on("scroll.nmShopPopupBtn resize.nmShopPopupBtn",function(){d&&clearTimeout(d);d=setTimeout(function(){a.$body.hasClass("shop-filters-popup-open")||a.shopFiltersPopupButtonToggle()},500)});a.$shopSidebarPopupBtn.on("click",function(){a.shopFiltersPopupShow()});c("#nm-shop-sidebar-popup-reset-button").on("click",function(b){b.preventDefault();
a.shopFiltersPopupReset()})}var f=a.isTouch?!1:!0,e=!1;a.$shopWrap.on("click","#nm-shop-sidebar .nm-widget-title",function(b){b=c(this).closest("li");if(b.hasClass("show"))f&&b.children(".nm-shop-widget-col").last().css("height",""),b.removeClass("show");else{var h=b.parent("#nm-shop-widgets-ul").children(".show");if(f){var g=b.children(".nm-shop-widget-col").last(),k=g.children().first().outerHeight(!0)+"px",l=h.children(".nm-shop-widget-col").last();g.css("height",k);l.css("height","");e||(e=!0,
a.$window.one("resize.nmShopWidget",function(){a.shopFiltersWidgetHideOpen();e=!1}))}h.removeClass("show");b.addClass("show")}});a.filtersEnableAjax&&a.$pageIncludes.hasClass("shop_filters")&&(a.$shopWrap.on("click","#nm-shop-sidebar .nm_widget a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_categories a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav a",
function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$document.on("nm_ajax_shop_update_content",function(){a.$shopWrap.on("change","#nm-shop-sidebar select.woocommerce-widget-layered-nav-dropdown",function(){var b=c(this),h=b.closest("form"),g=b.val(),k=b.attr("class");k=k.substr(k.lastIndexOf("_")+1);k=h.find('input[name="filter_'+k+'"]');k.length&&(k.val(g),b.attr("multiple")||h.submit())})}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_layered_nav_filters a",function(b){b.preventDefault();
a.shopGetPage(c(this).attr("href"))}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_product_tag_cloud a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"),!1,!0)}),a.$shopWrap.on("click","#nm-shop-sidebar .widget_rating_filter a",function(b){b.preventDefault();a.shopGetPage(c(this).attr("href"))}),a.$body.on("price_slider_change",function(b,h,g){b=c("#nm-shop-sidebar").find(".widget_price_filter").first().find("form");var k=parseInt(b.find("#min_price").attr("value")),l=parseInt(b.find("#max_price").attr("value"));
if(k!=h||l!=g)h=b.attr("action"),g=b.serialize(),a.shopGetPage(h+"?"+g)}))},shopFiltersCategoriesToggle:function(){var a=this,d=c("#nm-shop-categories-wrap"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f?d.removeClass("force-show").css("display",""):d.addClass("fade-in");a.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){c("#nm-shop-categories-wrap").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var a=
this,d=c("#nm-shop-sidebar"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f||d.addClass("fade-in");a.filterPanelSliding=!1})},shopFiltersWidgetHideOpen:function(){var a=c("#nm-shop-widgets-ul").children(".show");a.length&&a.find(".nm-widget-title").trigger("click")},shopDefaultSidebarToggle:function(){var a=this,d=c("#nm-shop-sidebar"),f=d.is(":visible");f&&d.removeClass("fade-in");d.slideToggle(a.filterPanelSlideSpeed,function(){f||d.addClass("fade-in");
a.filterPanelSliding=!1})},shopFiltersSearchToggle:function(){this.shopSearchTogglePanel();this.currentSearch=""},shopFiltersSearchClose:function(){this.searchEnabled&&this.$searchBtn.parent("li").hasClass("active")&&(this.categoryClicked=!0,this.$searchBtn.trigger("click"))},shopFiltersHideActivePanel:function(){var a=0,d=this.$shopFilterMenu.children(".active");if(d.length){d.removeClass("active");var f=d.data("panel");d.is(":hidden")&&"cat"==f?this.shopFiltersCategoriesReset():(a=300,this[this.shopFilterMenuFnNames[f]]())}return a},
shopFiltersPopupButtonToggle:function(){var a=this.$shopSidebarPopupBtn.hasClass("visible")?this.$shopSidebarPopupBtn.offset().top+this.$shopSidebarPopupBtn.outerHeight(!0):this.$shopSidebarPopupBtn.offset().top,d=this.$shopBrowseWrap.offset().top;a>d+190?this.shopFiltersPopupButtonShow():this.shopFiltersPopupButtonHide()},shopFiltersPopupButtonShow:function(){this.$shopSidebarPopupBtn.addClass("visible")},shopFiltersPopupButtonHide:function(){this.$shopSidebarPopupBtn.removeClass("visible")},shopFiltersPopupShow:function(){var a=
this;a.shopFiltersPopupButtonHide();a.$shopSidebarPopup.addClass("visible");a.$body.addClass("shop-filters-popup-open");a.$document.on("mouseup.filtersPopup",function(d){a.$shopSidebarPopup.is(d.target)||0!==a.$shopSidebarPopup.has(d.target).length||a.shopFiltersPopupHide()})},shopFiltersPopupHide:function(){var a=this;a.$shopSidebarPopup.removeClass("visible");a.shopFiltersPopupButtonToggle();a.$body.removeClass("shop-filters-popup-open");a.$document.off("mouseup.filtersPopup");setTimeout(function(){a.searchHideNotice()},
a.panelsAnimSpeed)},shopFiltersPopupReset:function(){var a=location.href.replace(location.search,"");this.shopGetPage(a);"0"!==nm_wp_vars.shopFiltersPopupAutoClose&&this.shopFiltersPopupHide()},shopExternalGetPage:function(a){var d=this;if(a==window.location.href)d.shopScrollToTop();else{c("#nm-shop-categories-wrap").find(".current-cat").removeClass("current-cat");var f=d.shopScrollToTop();setTimeout(function(){d.shopGetPage(a)},f)}},shopGetPage:function(a,d,f){var e=this;if(e.shopAjax)return!1;a&&
(e.shopRemoveNotices(),"popup"==e.shopSidebarLayout&&"0"!==nm_wp_vars.shopFiltersPopupAutoClose&&e.shopFiltersPopupHide(),e.$body.width()<e.filterPanelHideWidth?(e.shopShowLoader(!0),f=e.filterPanelSlideSpeed,e.filterPanelSlideSpeed=0,e.shopFiltersHideActivePanel(),e.filterPanelSlideSpeed=f):e.shopShowLoader(),a=a.replace(/\/?(\?|#|$)/,"/$1"),d||e.setPushState(a),e.shopAjax=c.ajax({url:a,data:{shop_load:"full",shop_filters_layout:e.shopSidebarLayout},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},
method:"POST",error:function(b,h,g){console.log("NM: AJAX error - shopGetPage() - "+g);e.shopHideLoader();e.shopAjax=!1},success:function(b){e.shopUpdateContent(b);e.shopAjax=!1}}))},shopUpdateContent:function(a){var d=this;a=c("<div>"+a+"</div>");if(nm_wp_vars.shopAjaxUpdateTitle){var f=a.find("#nm-wp-title").text();f.length&&(document.title=f)}var e=a.find("#nm-body-class"),b=a.find("#nm-shop-taxonomy-header"),h=a.find(".nm-shop-taxonomy-heading");f=a.find("#nm-shop-categories-wrap");var g=a.find("#nm-shop-widgets-ul"),
k=a.find("#nm-shop-browse-wrap");e.hasClass("post-type-archive")?d.$body.removeClass("tax-product_cat tax-product_tag").addClass("post-type-archive post-type-archive-product"):e.hasClass("tax-product_cat")?d.$body.removeClass("post-type-archive post-type-archive-product tax-product_tag").addClass("tax-product_cat"):e.hasClass("tax-product_tag")&&d.$body.removeClass("post-type-archive post-type-archive-product tax-product_cat").addClass("tax-product_tag");b.length?(e=c("#nm-shop-taxonomy-header"),
e.replaceWith(b),e.removeClass("hidden")):c("#nm-shop-taxonomy-header").addClass("hidden");h.length?c(".nm-shop-taxonomy-heading").replaceWith(h):c(".nm-shop-taxonomy-heading").addClass("hidden");f.length&&(b=c("#nm-shop-categories-wrap"),b.hasClass("fade-in")&&f.addClass("fade-in force-show"),b.replaceWith(f));g.length&&(c("#nm-shop-widgets-ul").replaceWith(g),d.shopFiltersInitPriceSlider());k.length&&d.$shopBrowseWrap.replaceWith(k);d.$document.trigger("nm_ajax_shop_update_content",a);d.$shopBrowseWrap=
c("#nm-shop-browse-wrap");"undefined"!=typeof d.shopInfLoadBound&&d.shopInfLoadBound||Object.getPrototypeOf(d).hasOwnProperty("infload_init")&&d.infload_init();a=d.shopScrollToTop();setTimeout(function(){d.shopHideLoader()},a)},shopFiltersInitPriceSlider:function(){if("undefined"===typeof woocommerce_price_slider_params)return!1;c(document.body).on("price_slider_create price_slider_slide",function(a,d,f){c(".price_slider_amount span.from").html(accounting.formatMoney(d,{symbol:woocommerce_price_slider_params.currency_format_symbol,
decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format}));c(".price_slider_amount span.to").html(accounting.formatMoney(f,{symbol:woocommerce_price_slider_params.currency_format_symbol,decimal:woocommerce_price_slider_params.currency_format_decimal_sep,thousand:woocommerce_price_slider_params.currency_format_thousand_sep,
precision:woocommerce_price_slider_params.currency_format_num_decimals,format:woocommerce_price_slider_params.currency_format}));c(document.body).trigger("price_slider_updated",[d,f])});(function(){c("input#min_price, input#max_price").hide();c(".price_slider, .price_label").show();var a=c(".price_slider_amount #min_price").data("min"),d=c(".price_slider_amount #max_price").data("max"),f=c(".price_slider_amount").data("step")||1,e=c(".price_slider_amount #min_price").val(),b=c(".price_slider_amount #max_price").val();
c(".price_slider:not(.ui-slider)").slider({range:!0,animate:!0,min:a,max:d,step:f,values:[e,b],create:function(){c(".price_slider_amount #min_price").val(e);c(".price_slider_amount #max_price").val(b);c(document.body).trigger("price_slider_create",[e,b])},slide:function(h,g){c("input#min_price").val(g.values[0]);c("input#max_price").val(g.values[1]);c(document.body).trigger("price_slider_slide",[g.values[0],g.values[1]])},change:function(h,g){c(document.body).trigger("price_slider_change",[g.values[0],
g.values[1]])}})})()}});c.nmThemeExtensions.filters=c.nmTheme.filters_init})(jQuery);